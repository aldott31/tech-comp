<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Scraper Form View -->
    <record id="tech_company_scraper_view_form" model="ir.ui.view">
        <field name="name">tech.company.scraper.form</field>
        <field name="model">tech.company.scraper</field>
        <field name="arch" type="xml">
            <form string="Data Scraper">
                <header>
                    <button name="action_run_scraping_job"
                            type="object"
                            string="Run QKB Scraping Now"
                            class="btn-primary"
                            icon="fa-refresh"
                            confirm="This will scrape QKB for IT companies in Tirane. It runs in background. Continue?"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>QKB Scraper - Albanian Tech Map</h1>
                    </div>

                    <group>
                        <group string="Last Run">
                            <field name="last_run" readonly="1"/>
                            <field name="companies_found" readonly="1"/>
                        </group>
                        <group string="Results">
                            <field name="companies_created" readonly="1"/>
                            <field name="companies_updated" readonly="1"/>
                        </group>
                    </group>

                    <group string="Log" invisible="status_log == False">
                        <field name="status_log" readonly="1" nolabel="1"/>
                    </group>

                    <div class="alert alert-info" role="alert">
                        <h4>How it works:</h4>
                        <ol>
                            <li><strong>Scrapes QKB</strong> - 48 keywords x 2 fields (name + activity) x 37 date ranges x 3 legal forms</li>
                            <li><strong>Date range splitting</strong> - Bypasses QKB's 50-result limit per search by splitting into quarterly time windows</li>
                            <li><strong>Downloads PDFs</strong> - Extracts email and phone for each company</li>
                            <li><strong>Geocodes</strong> - Uses Nominatim (OpenStreetMap) for GPS coordinates</li>
                            <li><strong>Updates database</strong> - Creates new or updates existing records (commits every 10 companies)</li>
                        </ol>
                        <p class="mb-0">
                            <strong>Cron:</strong> Runs automatically every 24 hours.<br/>
                            <strong>Note:</strong> The scraping runs in background - you can close this window.
                            Check Odoo logs for real-time progress.
                        </p>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Scraper Action -->
    <record id="tech_company_scraper_action_form" model="ir.actions.act_window">
        <field name="name">Run QKB Scraper</field>
        <field name="res_model">tech.company.scraper</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <!-- Menu Item -->
    <menuitem id="menu_tech_scraper"
        name="Run QKB Scraper"
        parent="menu_tech_map_tools"
        action="tech_company_scraper_action_form"
        sequence="10"/>

</odoo>
